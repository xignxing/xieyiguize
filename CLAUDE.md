# Claude 全局开发规则 v1.0

> 此规则适用于所有项目，确保一致性和质量

---

## 第一部分：核心行为规则（MUST 遵守）

<critical_rules>

### 规则 1: 先读后做
修改任何文件之前，MUST 先用 Read 工具读取该文件。
NEVER 基于记忆或假设修改文件。

### 规则 2: 先查后建
创建任何文件/函数/组件之前，MUST 先用 Glob/Grep 检查是否已存在。
NEVER 重复创建或覆盖现有代码。

### 规则 3: 失败不重复
当某个方法尝试失败后：
1. 记录失败的方法和原因
2. 维护「已排除方案」列表
3. NEVER 再次尝试已证伪的方案
4. 3次失败后停下来重新分析根因

### 规则 4: 验证关闭
每次代码修改后，MUST 验证结果：
- 运行相关命令确认无报错
- 不要假设修改成功

### 规则 5: 不确定就说
当不确定时，明确说「我不确定」。
区分「我验证过」vs「我认为」。

</critical_rules>

---

## 第二部分：文件管理规则

<file_management>

### 规则 6: 临时文件必须清理
创建的任何临时文件、测试脚本、调试文件，任务结束时 MUST 删除。
包括但不限于：
- `test-*.js`、`debug-*.js`、`temp-*.js`
- `temp/`、`tmp/` 目录下的文件
- 一次性迁移脚本（执行成功后删除）
- `.bak`、`.backup` 备份文件
- 调试用的 `console.log` 文件

### 规则 7: 文档创建限制
NEVER 随意创建文档文件。
项目允许的文档文件：
- `README.md` - 项目说明
- `CHANGELOG.md` - 变更日志（可选）
- `project-context.md` - 项目知识库
- `.env.example` - 环境变量示例
- `docs/` 目录下的 API 文档（如需要）

NEVER 创建：
- 随意的 `notes.md`、`TODO.md`、`temp.md`
- 重复的说明文档
- 未经讨论的新文档

### 规则 8: 只改要求的部分
- 只修改被明确要求修改的代码
- NEVER「顺便优化」其他代码
- NEVER 添加未被要求的功能
- NEVER 重构未被提及的部分

</file_management>

---

## 第三部分：环境规则

<environment>

### 规则 9: 系统环境识别
启动时识别当前系统环境：
- Windows: 使用 Windows 兼容命令，路径用 `/` 或 `\\`
- Mac/Linux: 使用 Unix 命令

先确认命令正确再执行，不要试错。

### 规则 10: 端口规范
推荐使用 9700+ 范围的端口，避免与常用服务冲突：

常见冲突端口（避免使用）：
- 3000 (Node 默认)
- 5173, 5174 (Vite 默认)
- 8080, 8000 (常用 Web)
- 3306 (MySQL)
- 5432 (PostgreSQL)

推荐端口范围：9700-9799

每个项目的端口 MUST 记录在 `project-context.md` 中。

</environment>

---

## 第四部分：项目知识库规则

<project_context>

### 规则 11: 知识库使用
每个项目应有 `project-context.md`，包含：
1. 项目基本信息和技术栈
2. 端口配置
3. 启动/停止命令（已验证）
4. 已证伪的错误方法（不再尝试）
5. 项目特定约定

任务开始时 MUST 读取此文件（如存在）。

### 规则 12: 知识库更新
当发现以下情况时，更新 `project-context.md`：
- 新的正确方法被验证
- 新的错误方法被证伪
- 项目配置发生变化

</project_context>

---

## 第五部分：工作流程

<workflow>

### 开始任务
1. 读取 `project-context.md`（如存在）
2. 理解任务需求
3. 做最小必要的计划

### 执行任务
1. 先读相关文件
2. 做最小必要修改
3. 验证修改结果
4. 失败时记录并分析

### 结束任务
1. 确认所有修改已验证
2. 清理临时文件
3. 更新 `project-context.md`（如有新发现）

</workflow>

---

## 第六部分：防回归规则

<anti_regression>

### 规则 13: 修改前声明
每次修改代码前，MUST 声明将要修改的文件列表。
格式：「我将修改以下文件：[文件列表]」

### 规则 14: 修改后报告
修改完成后，MUST 报告实际改动：
- 修改了哪些文件
- 每个文件改动了什么（简要描述）
- 是否有意外改动其他代码

### 规则 15: 原子提交
每完成一个独立功能，建议立即提交 Git：
- 不要积累多个功能一起提交
- 每个提交只包含一个逻辑单元
- 提交消息清晰描述改动内容

### 规则 16: 改动范围确认
修改代码时：
- 只改明确要求的部分
- 如果发现需要修改其他文件，先询问用户
- NEVER「顺便优化」相关代码

</anti_regression>

---

## 规则总结

| # | 规则 | 类别 | 关键词 |
|---|------|------|--------|
| 1 | 先读后做 | 核心 | 防幻觉 |
| 2 | 先查后建 | 核心 | 防重复 |
| 3 | 失败不重复 | 核心 | 防循环 |
| 4 | 验证关闭 | 核心 | 确认结果 |
| 5 | 不确定就说 | 核心 | 防臆想 |
| 6 | 临时文件必须清理 | 文件 | 保持整洁 |
| 7 | 文档创建限制 | 文件 | 防混乱 |
| 8 | 只改要求的部分 | 文件 | 防过度修改 |
| 9 | 系统环境识别 | 环境 | 正确命令 |
| 10 | 端口规范 | 环境 | 防冲突 |
| 11 | 知识库使用 | 知识 | 持久记忆 |
| 12 | 知识库更新 | 知识 | 防遗忘 |
| 13 | 修改前声明 | 防回归 | 透明度 |
| 14 | 修改后报告 | 防回归 | 可追溯 |
| 15 | 原子提交 | 防回归 | 易回滚 |
| 16 | 改动范围确认 | 防回归 | 防越界 |
